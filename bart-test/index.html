<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" dir="rtl">
  <head>
    <title>ניסוי</title>
    <meta charset="utf-8" />

    <!-- these files are required for the BART to work    -->
    <script type="text/javascript" src="src/jquery-3.0.0.min.js"></script> <!-- basic javascript library for dom manipulation -->
    <script type="text/javascript" src="src/jcanvas.min.js"></script>      <!-- the canvas plugin -->
    <script type="text/javascript" src="src/jquery.bart.js"></script>      <!-- the main BART plugin -->
    <link rel="stylesheet" type="text/css" href="src/jquery.bart.css" />   <!-- additional styles for to make the BART look fancy -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- additional scripts to run the demo on this page -->
  <script type="text/javascript">
    //<![CDATA[
    
    var readyToStart = false;

    // Select the experiment group (mt=1/non-mt=0) 
    var experimentGroup;
    var urlExperimentGroupColumn = "https://sheets.googleapis.com/v4/spreadsheets/1dcMtqcaZWEMNIGioV6910tRyE0t27jvku91aC_S9EMg/values/Sheet1!A2:A1000?key=AIzaSyDRyViKp4jP-4DiVUeLHsE8O8bciMNtTCs"
    
    $.getJSON(urlExperimentGroupColumn, function(data) {
      var count0 = 0;
      var count1 = 0;
      for (v in data.values) {
        if (data.values[v]=="0") count0++;
        else if (data.values[v]=="1") count1++;
      }

      experimentGroup = count0 > count1 ? 1 : 0;
      console.log(count0 + " 0s, " + count1 + " 1s. Setting group to " + experimentGroup);
      readyToStart = true;
      startExperiment();
    });

    function startExperiment() {
      if (!readyToStart) return;

      $("#openness-div").show();
      $('#loadingModal').modal("hide");
    }

    var bartData;

    // Helper for enterKey in inputs
    $.fn.enterKey = function (fnc) {
      return this.each(function () {
        $(this).keypress(function (ev) {
          var keycode = (ev.keyCode ? ev.keyCode : ev.which);
          if (keycode == '13') {
            fnc.call(this, ev);
          }
        })
      })
    }
    
    // initialize the BART after the page has loaded
    $(document).ready(function () {

        // Start the loading screen
        $('#loadingModal').modal({
            show: 'true'
        }); 
      
      // Hide all relevant divs
      if (!readyToStart) $("#openness-div").hide();
      $("#ms-div").hide();
      $("#bart-div").hide();
      $("#done-div").hide();
      $("#after-questions").hide();

      // Setup BART
      var bOpts = {
        min_pump: 2, 
        earnings: 0.25,
        onstart: function(){ this.start_time= $.now(); },
        onexplode: function(){ this.end_time = $.now(); },
        oncashin: function(){ this.end_time = $.now(); }
      };

      // create a BART
      $("#bart").bart(
        {b: [
          {b: 1, o: $.extend({color: 'blue', popprob: 8 }, bOpts)},
          {b: 0, o: $.extend({color: 'red', popprob: 128 }, bOpts)},
          {b: 0, o: $.extend({color: 'yellow', popprob: 32}, bOpts)}
        ],
         s: {
            txt_cashin: 'קח את הכסף',
            txt_inflate: 'נפח',
            txt_next: 'הבא:',
            txt_balloon_number: 'בלון: ',
            txt_number_of_pumps: 'ניפוחים: ',
            txt_current_earned: 'שווי הבלון: ₪',
            txt_total_earned: 'סה"כ: ₪',
            txt_prob_explosion: 'סיכוי לפיצוץ: ',
            txt_pumps_used: 'pumps_used: ',
           showpopprob: false,
           sounds: true,
           onload: function () {
             this.start_time = $.now();
           },
           onend: function () {
             this.end_time = $.now();
             this.balloon = null;
             console.log(this);
             endBart();
             bartData = this;
           }
         }
        }
      );

      $("#cont1").click(function(){
        // Validate the input
        var valid = true;
        valid = $("input[name^='q']:checked").length == 9;

        if (valid){
            $("#openness-div").hide("slow", "swing");
            $("#ms-div").show();
        } else {
            alert("אנא מלא את כל המסיחים")
        }
      });

      var MIN_TEXT_SIZE = 20;

      function validateMSText(){
        return $("#death1").val().length >= MIN_TEXT_SIZE && $("#death2").val().length >= MIN_TEXT_SIZE; 
      }

      $("#cont2").click(function(){
        if (validateMSText()){
            $("#ms-div").hide("slow", "swing");
            $("#bart-div").show();
        } else {
            alert("אנא מלא/י לפחות 20 תווים בתיבות הטקסט");
        }
      });

      function endBart(){
        $("#bart-div").hide("slow", "swing");
        $("#after-questions").show();
      } 
      $("#cont3").click(function(){
        var valid = true;
        if (valid){
            $("#after-questions").hide("slow", "swing");
            saveToGoogleSheets(bartData);
        } else {
            alert("אנא מלא/י את כל השאלות")
        }
           
      });            
    });

    // Send data to Google Spreadsheets:

    var url = 'https://script.google.com/macros/s/AKfycbyC1KeNpB8MkE98at9wy5zr6jw-z1LZSn21v9n1I1hmWHUo7REs/exec';
    function saveToGoogleSheets(bartData) {
      var data = {
        "group": experimentGroup,
        "q1": $("input[name='q1']:checked").val(),
        "q2": $("input[name='q2']:checked").val(),
        "q3": $("input[name='q3']:checked").val(),
        "q4": $("input[name='q4']:checked").val(),
        "q5": $("input[name='q5']:checked").val(),
        "q6": $("input[name='q6']:checked").val(),
        "q7": $("input[name='q7']:checked").val(),
        "q8": $("input[name='q8']:checked").val(),
        "q9": $("input[name='q9']:checked").val(),
        "death": $("#death").val(),
        "bart": bartData.earned
      };
      console.log(data);
      console.log("saving...");
      $('#loadingModal').modal("show");
      $.ajax({
        url: url,
        method: "GET",
        dataType: "json",
        data: data,
        success: function() {
          console.log("saved data to google spreadsheets");
          $('#loadingModal').modal("hide");
          $("#done-div").show();
        }
      });
    }

    startExperiment();    

    //]]>
  </script>
  </head>
    <body>
        <div style="width: 600px; margin:auto;">            
            <h1 style="text-align: center;">ניסוי</h1>
            <br/><br/>
        </div>

        <!-- Loading modal -->
        <div class="modal fade" id="loadingModal" role="dialog">
            <div class="modal-dialog">
            
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-body">
                  <h1>טוען............</h1>
                </div>
              </div>
              
            </div>
        </div>
        <!--End of Loading modal -->


        <div class="container">
            <form>
            <div id="openness-div">
                <div class="row"><h2>אני רואה עצמי כאדם מקורי הנוטה להעלות רעיונות חדשים</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="q1" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="q1" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="q1" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="q1" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="q1" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני רואה עצמי כסקרן/נית לגבי דברים רבים</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="q2" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="q2" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="q2" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="q2" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="q2" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני רואה עצמי כאדם חכם, שנון ומעמיק</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="q3" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="q3" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="q3" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="q3" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="q3" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני רואה עצמי כבעל/ת דמיון פעיל</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="q4" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="q4" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="q4" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="q4" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="q4" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני רואה עצמי כ"ממציא"</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="q5" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="q5" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="q5" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="q5" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="q5" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני יודע להעריך התנסויות אסתטיות ואומנותיות</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="q6" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="q6" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="q6" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="q6" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="q6" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני מעדיף/ה עבודה שגרתית</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="q7" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="q7" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="q7" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="q7" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="q7" value="5"> 5 </div>
                </div>

                <div class="row"><h2>לעתים קרובות אני נהנה/נהנית לחשוב ולהשתעשע ברעיונות מופשטים</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="q8" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="q8" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="q8" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="q8" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="q8" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני מגלה עניין מועט באומנות</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="q9" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="q9" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="q9" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="q9" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="q9" value="5"> 5 </div>
                </div>

                <button type="button" id="cont1" class="btn btn-primary">המשך</button>
            </div>


            <div id="ms-div">
                <div class="row"><h2>כתוב כל מיני מחשבות על המוות שלך</h2></div>
                <div class="row"><textarea rows="10" cols="100" id="death1"></textarea></div>

                <div class="row"><h2>כתוב כל מיני מחשבות על המוות שלך</h2></div>
                <div class="row"><textarea rows="10" cols="100" id="death2"></textarea></div>

                <button type="button" id="cont2" class="btn btn-primary">המשך</button>
            </div>

            <div id="bart-div">
                <!-- load BART here -->
                <h3>הסברים על הבארט אם בא לנו</h3>
                <div id="bart"></div>
            </div>

            <div id="after-questions">
                <h4>אנא מלא את הפרטים הבאים</h4>
                <h3>גיל: </h3> <input type="text" />

                <h3>מין: </h3>
                    <input type="radio" name="after-q1" value="male"> זכר </br>
                    <input type="radio" name="after-q1" value="female"> נקבה </br>

                <div class="row"><h2>שאלה 1</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="5"> 5 </div>
                </div>

                <div class="row"><h2>שאלה 2</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="5"> 5 </div>
                </div>

                <button type="button" id="cont3" class="btn btn-primary">המשך</button>
            </div>

            <div id="done-div">
                <h1>תודה רבה!</h1>
                <h2>הניסוי הסתיים</h2>
            </div>
            </form>
        </div>


        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    </body>

</html>
