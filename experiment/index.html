<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" dir="rtl">
  <head>
    <title>ניסוי</title>
    <meta charset="utf-8" />

    <!-- these files are required for the BART to work    -->
    <script type="text/javascript" src="src/jquery-3.0.0.min.js"></script> <!-- basic javascript library for dom manipulation -->
    <script type="text/javascript" src="src/jcanvas.min.js"></script>      <!-- the canvas plugin -->
    <script type="text/javascript" src="src/jquery.bart.js"></script>      <!-- the main BART plugin -->
    <link rel="stylesheet" type="text/css" href="src/jquery.bart.css" />   <!-- additional styles for to make the BART look fancy -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- additional scripts to run the demo on this page -->
  <script type="text/javascript">
    //<![CDATA[
    
    // Set this to true to bypass validation and shorten the bart test.
    var testMode = true; 

    // When this is true it means we have everything we need to start the experiment.
    var readyToStart = false;

    // Id of the Google Spreadsheet we use as database.
    var spreadsheetId = "1dcMtqcaZWEMNIGioV6910tRyE0t27jvku91aC_S9EMg";

    // Google API key for reading the spreadhseet.
    var apiKey = "AIzaSyDRyViKp4jP-4DiVUeLHsE8O8bciMNtTCs";

    // Select the experiment group (mt=1/non-mt=0) 
    var experimentGroup;

    // Retrieve group column from spreadhseet.
    var urlExperimentGroupColumn = "https://sheets.googleapis.com/v4/spreadsheets/" 
        + spreadsheetId + "/values/Sheet1!A2:A1000?key=" + apiKey;
    
    $.getJSON(urlExperimentGroupColumn, function(data) {
      var count0 = 0;
      var count1 = 0;
      for (v in data.values) {
        if (data.values[v]=="0") count0++;
        else if (data.values[v]=="1") count1++;
      }

      experimentGroup = count0 > count1 ? 1 : 0;
      console.log(count0 + " 0s, " + count1 + " 1s. Setting group to " + experimentGroup);

      readyToStart = true;
      $("#start").attr("disabled", false);
      $("#start").html("התחל");
    });

    var bartData;

    // Helper for enterKey in inputs
    $.fn.enterKey = function (fnc) {
      return this.each(function () {
        $(this).keypress(function (ev) {
          var keycode = (ev.keyCode ? ev.keyCode : ev.which);
          if (keycode == '13') {
            fnc.call(this, ev);
          }
        })
      })
    }
    
    // This will run once you can safely access DOM
    $(document).ready(function () {
      // start button is disabled until experiment is ready.
      $("#start").attr("disabled", true);

      // Setup BART
      balloonCount = 45;

      var bOpts = {
        min_pump: 2, 
        earnings: 0.25,
        onstart: function(){ this.start_time= $.now(); },
        onexplode: function(){ this.end_time = $.now(); },
        oncashin: function(){ this.end_time = $.now(); }
      };

      // create a BART
      $("#bart").bart(
        {b: [
          {b: (testMode ? 0 : balloonCount/3), o: $.extend({color: 'blue', popprob: 8 }, bOpts)},
          {b: (testMode ? 1 : balloonCount/3), o: $.extend({color: 'red', popprob: 128 }, bOpts)},
          {b: (testMode ? 0 : balloonCount/3), o: $.extend({color: 'yellow', popprob: 32}, bOpts)}
        ],
         s: {
            txt_cashin: 'קחו את הכסף',
            txt_inflate: 'נפחו',
            txt_next: 'הבא:',
            txt_balloon_number: 'בלון: ',
            txt_number_of_pumps: 'ניפוחים: ',
            txt_current_earned: 'שווי הבלון: ₪',
            txt_total_earned: 'סה"כ: ₪',
            txt_prob_explosion: 'סיכוי לפיצוץ: ',
            txt_pumps_used: 'pumps_used: ',
           showpopprob: false,
           sounds: true,
           onload: function () {
             this.start_time = $.now();
           },
           onend: function () {
             this.end_time = $.now();
             this.balloon = null;
             console.log(this);
             endBart();
             bartData = this;
           }
         }
        }
      );

      function manipulationShow(){
        if (experimentGroup == 1)
            $("#ms-div").show();
        else
            $("#non-ms-div").show();
      }

      function manipulationHide(){
        if (experimentGroup == 1)
            $("#ms-div").hide("slow", "swing");
        else
            $("#non-ms-div").hide("slow", "swing");
      }

      $("#start").click(function() {
        $("#openness-div").show();
        $("#welcome-div").hide("slow", "swing");
      });

      $("#cont1").click(function(){
        // Validate the input
        var valid = $("input[name^='q']:checked").length == 9;

        if (testMode || valid){
            $("#openness-div").hide("slow", "swing");
            manipulationShow();
        } else {
            alert("אנא ענו על כל השאלות.")
        }
      });

      var MIN_TEXT_SIZE = 20;

      function validateText(){
        if (experimentGroup == 1)
            return $("#ms1").val().length >= MIN_TEXT_SIZE && $("#ms2").val().length >= MIN_TEXT_SIZE;
        else
            return $("#non-ms1").val().length >= MIN_TEXT_SIZE && $("#non-ms2").val().length >= MIN_TEXT_SIZE;
      }

      $(".manipulation-continue").click(function(){
        if (testMode || validateText()){
            manipulationHide();
            $("#bart-instructions").show();
        } else {
            alert("אנא מלא/י לפחות 20 תווים בתיבות הטקסט.");
        }
      });

      $("#contToBart").click(function(){
        $("#bart-instructions").hide("slow", "swing");
        $("#bart-div").show();
      });

      function endBart(){
        $("#bart-div").hide("slow", "swing");
        $("#after-questions").show();
      } 
      $("#cont3").click(function(){
        var valid = true;
        if (testMode || valid){
            $("#after-questions").hide("slow", "swing");
            saveToGoogleSheets(bartData);
        } else {
            alert("אנא ענו על כל השאלות.")
        }
           
      });            
    });

    // Send data to Google Spreadsheets:

    var url = 'https://script.google.com/macros/s/AKfycbyC1KeNpB8MkE98at9wy5zr6jw-z1LZSn21v9n1I1hmWHUo7REs/exec';
    function saveToGoogleSheets(bartData) {
      var data = {
        "group": experimentGroup,
        "openness1": $("input[name='openness1']:checked").val(),
        "openness2": $("input[name='openness2']:checked").val(),
        "openness3": $("input[name='openness3']:checked").val(),
        "openness4": $("input[name='openness4']:checked").val(),
        "openness5": $("input[name='openness5']:checked").val(),
        "openness6": $("input[name='openness6']:checked").val(),
        "openness7": $("input[name='openness7']:checked").val(),
        "openness8": $("input[name='openness8']:checked").val(),
        "openness9": $("input[name='openness9']:checked").val(),
        "ms1": $("#ms1").val(),
        "ms2": $("#ms2").val(),
        "non-ms1": $("#non-ms1").val(),
        "non-ms2": $("#non-ms2").val(),
        "bart": bartData.earned
      };
      console.log(data);
      console.log("saving...");
      $('#done-div').show();

      $.ajax({
        url: url,
        method: "GET",
        dataType: "json",
        data: data,
        success: function() {
          console.log("saved data to google spreadsheets");
          $("#wait-to-save").html("המידע נשמר!");
        }
      });
    }

    //]]>
  </script>
  </head>
    <body>
        <!-- Loading modal -->
        <div class="modal fade" id="loadingModal" role="dialog">
            <div class="modal-dialog">
            
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-body">
                  <h1>טוען............</h1>
                </div>
              </div>
              
            </div>
        </div>
        <!--End of Loading modal -->


        <div class="container">
          <div id="welcome-div" style="div p { font-size: 120%; }">
            <h1>מחקר בפסיכולוגיה ניסויית</h1>
            <p>שלום,</p>
            <p>אנחנו גיל, טל וליאור, סטודנטים לתואר ראשון בפסיכולוגיה באוניברסיטת תל אביב. במסגרת לימודינו אנו עורכים מחקר בנושא קבלת החלטות ונעריך זאת אם תסכים/י להשתתף בו.</p>
            <p>במחקר תתבקש/י לבצע מטלות שונות, נבקש שתענה/י עליהן בכנות ובריכוז.
השאלון הוא אנונימי ומובטחת לך סודיות באשר לזהותך האישית. תשובותיך ישמשו לצורך מחקר זה בלבד.
</p>
            <p>הזמן הדרוש עבור ההשתתפות בניסוי הוא כ־10 דקות. 
יש לבצע את המטלות בעזרת מחשב בלבד (ולא באמצעות סמרטפון, למשל), עם רמקולים פועלים או עם אוזניות וללא הפסקות.
              </p><br>
            <p>בלחיצה על כפתור "התחל" הנך מאשר/ת את השתתפותך בניסוי, עם זאת, ניתן להפסיק את ההשתתפות בכל עת.</p>
            <p>תודה רבה!</p>
            <button type="button" id="start" class="btn btn-primary">טוען...</button>
          </div>
            <form>
            <div id="openness-div" style="display: none;">
                <div class="row"><h2>אני רואה עצמי כאדם מקורי הנוטה להעלות רעיונות חדשים</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="openness1" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="openness1" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="openness1" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="openness1" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="openness1" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני רואה עצמי כסקרן/נית לגבי דברים רבים</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="openness2" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="openness2" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="openness2" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="openness2" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="openness2" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני רואה עצמי כאדם חכם, שנון ומעמיק</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="openness3" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="openness3" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="openness3" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="openness3" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="openness3" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני רואה עצמי כבעל/ת דמיון פעיל</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="openness4" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="openness4" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="openness4" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="openness4" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="openness4" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני רואה עצמי כ"ממציא"</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="openness5" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="openness5" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="openness5" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="openness5" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="openness5" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני יודע להעריך התנסויות אסתטיות ואומנותיות</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="openness6" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="openness6" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="openness6" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="openness6" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="openness6" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני מעדיף/ה עבודה שגרתית</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="openness7" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="openness7" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="openness7" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="openness7" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="openness7" value="5"> 5 </div>
                </div>

                <div class="row"><h2>לעתים קרובות אני נהנה/נהנית לחשוב ולהשתעשע ברעיונות מופשטים</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="openness8" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="openness8" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="openness8" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="openness8" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="openness8" value="5"> 5 </div>
                </div>

                <div class="row"><h2>אני מגלה עניין מועט באומנות</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="openness9" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="openness9" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="openness9" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="openness9" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="openness9" value="5"> 5 </div>
                </div>

                <button type="button" id="cont1" class="btn btn-primary">המשך</button>
            </div>


            <div id="ms-div" style="display: none;">
                <div class="row"><h2>תאר/י בקצרה את הרגשות העולים בך כאשר את/ה חושב/ת על מותך.</h2></div>
                <div class="row"><textarea rows="10" cols="100" id="ms1"></textarea></div>

                <div class="row"><h2>תאר/י, באופן ספציפי עד כמה שתוכל/י, מה יקרה לגופך ברגע שתמות/י ולאחר מכן.</h2></div>
                <div class="row"><textarea rows="10" cols="100" id="ms2"></textarea></div>

                <button type="button" class="manipulation-continue btn btn-primary">המשך</button>
            </div>

            <div id="non-ms-div" style="display: none;">
                <div class="row"><h2>.תאר/י בקצרה את הרגשות העולים בך כאשר את/ה חושב/ת על ביקור אצל רופא השיניים</h2></div>
                <div class="row"><textarea rows="10" cols="100" id="non-ms1"></textarea></div>

                <div class="row"><h2>תאר/י, באופן ספציפי עד כמה שתוכל/י, מה יקרה לך בעת ביקור אצל רופא השיניים.</h2></div>
                <div class="row"><textarea rows="10" cols="100" id="non-ms2"></textarea></div>

                <button type="button" class="manipulation-continue btn btn-primary">המשך</button>
            </div>

            <div id="bart-instructions" style="display: none;">
                <p>
                <h3>
בחלק הבא של הניסוי  מטרתכם היא לנפח בלונים ולצבור כמה שיותר כסף. בכל שלב עליכם להחליט האם לנפח את הבלון בעזרת לחיצה על מקש הרווח או על הכפתור ״נפחו״ ובכך להגדיל את שוויו, או לאסוף את הכסף שצברתם עבור בלון זה בעזרת לחיצה על מקש C או על הכפתור ״קחו את הכסף״. שימו לב שהבלונים עלולים להתפוצץ בכל רגע החל מהניפוח הראשון ועד למצב שהבלון ממלא את כל המסך. אם הבלון יתפוצץ לא תוכלו לקבל עליו כסף כלל. בכל שלב יצוין על המסך שווי הבלון הנוכחי, מספר הפעמים שניפחתם בלון זה וסך הכסף שנאסף.
                </h3>
                </p>
                <button type="button" id="contToBart" class="btn btn-primary">המשך</button>
            </div>

            <div id="bart-div" style="display: none;">
                <!-- load BART here -->
                <div id="bart" style="align: center"></div>
            </div>

            <div id="after-questions" style="display: none;">
                <h4>אנא מלא את הפרטים הבאים</h4>
                <h3>גיל: </h3> <input type="text" />

                <h3>מין: </h3>
                    <input type="radio" name="after-q1" value="male"> זכר </br>
                    <input type="radio" name="after-q1" value="female"> נקבה </br>

                <div class="row"><h2>שאלה 1</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="after-q2" value="5"> 5 </div>
                </div>

                <div class="row"><h2>שאלה 2</h2></div>

                <div class="row">
                    <div class="col-md-4">&nbsp;</div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="1"> 1 </div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="2"> 2 </div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="3"> 3 </div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="4"> 4 </div>
                    <div class="col-md-1"><input type="radio" name="after-q3" value="5"> 5 </div>
                </div>

                <button type="button" id="cont3" class="btn btn-primary">המשך</button>
            </div>

            <div id="done-div" style="display: none;">
                <h1>תודה רבה!</h1>
                <h2>הניסוי הסתיים</h2>
                <h2 id="wait-to-save">אנא המתן לשמירת התוצאות...</h2>
            </div>
            </form>
        </div>


        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    </body>

</html>
